"use strict";(self.webpackChunkcangulo_github_io=self.webpackChunkcangulo_github_io||[]).push([[2232],{63093:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return d},contentTitle:function(){return h},metadata:function(){return k},assets:function(){return f},toc:function(){return g},default:function(){return v}});var n=a(83117),o=a(80102),l=(a(67294),a(3905)),r=a(64888),i=a(46785),s=a(26684),u=a(93511),c=a(84964),m=a(46339),p=(a(26396),a(58215),["components"]),d={slug:"bash/3-load-vars",title:"Load custom variables at Terminal startup",date:new Date("2020-12-15T00:00:00.000Z"),group:"blog",authors:"cangulo",tags:["linux","productivity","hack","bash","zsh","terminal"]},h=void 0,k={permalink:"/blog/bash/3-load-vars",editUrl:"https://github.com/cangulo/cangulo.github.io/blob/main/blog/posts/bash/3-load-vars/3-load-vars.mdx",source:"@site/blog/posts/bash/3-load-vars/3-load-vars.mdx",title:"Load custom variables at Terminal startup",description:"In this post, I will explain how to import custom environment variables from a JSON file.",date:"2020-12-15T00:00:00.000Z",formattedDate:"December 15, 2020",tags:[{label:"linux",permalink:"/blog/tags/linux"},{label:"productivity",permalink:"/blog/tags/productivity"},{label:"hack",permalink:"/blog/tags/hack"},{label:"bash",permalink:"/blog/tags/bash"},{label:"zsh",permalink:"/blog/tags/zsh"},{label:"terminal",permalink:"/blog/tags/terminal"}],readingTime:3.04,truncated:!0,authors:[{name:"Carlos Angulo Mascarell",title:"Software Engineer",url:"https://github.com/cangulo",imageURL:"https://github.com/cangulo/cangulo/raw/main/profile_picture_preview_icon.png",key:"cangulo"}],prevItem:{title:"How to use a repository for importing your bash scripts and shortcuts",permalink:"/blog/bash/4-create-config-repo"},nextItem:{title:"Add shortcuts to your bash terminal",permalink:"/blog/bash/2-add-shortcuts"}},f={authorsImageUrls:[void 0]},g=[{value:"Requirements",id:"requirements",children:[],level:2},{value:"Notes",id:"notes",children:[],level:2},{value:"Variables",id:"variables",children:[],level:2},{value:"Behavior vs Configuration",id:"behavior-vs-configuration",children:[],level:2},{value:"One extra mile: Define the parameters as JSON",id:"one-extra-mile-define-the-parameters-as-json",children:[],level:2}],b={toc:g};function v(e){var t=e.components,h=(0,o.Z)(e,p);return(0,l.kt)("wrapper",(0,n.Z)({},b,h,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"In this post, I will explain how to import custom environment variables from a JSON file.\nI will also improve the shortcuts we create in the previous posts."),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Linux (I'm using ",(0,l.kt)("a",{parentName:"li",href:"https://elementary.io"},"Elementary OS"),", a Ubuntu-based distro, try it!)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://code.visualstudio.com"},"VS Code"),". If you don't want to use it, change all the ",(0,l.kt)("inlineCode",{parentName:"li"},"code")," commands in the bash code for your text editor. Alternatives: ",(0,l.kt)("em",{parentName:"li"},"gedit")," or ",(0,l.kt)("a",{parentName:"li",href:"https://gitlab.gnome.org/GNOME/gnome-text-editor"},"gnome-text-editor"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/junegunn/fzf"},"fzf")," command-line fuzzy finder")),(0,l.kt)("h2",{id:"notes"},"Notes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Remember to add execution permissions to the scripts through ",(0,l.kt)("inlineCode",{parentName:"li"},"chmod +x")),(0,l.kt)("li",{parentName:"ul"},"Profile script: ",(0,l.kt)("inlineCode",{parentName:"li"},"$HOME/.bashrc")," for bash terminal and ",(0,l.kt)("inlineCode",{parentName:"li"},"$HOME/.zshrc")," for zsh ")),(0,l.kt)("h2",{id:"variables"},"Variables"),(0,l.kt)("p",null,"Let's say I want to define some variables as:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"my local github repositories path"),(0,l.kt)("li",{parentName:"ul"},"my documents path"),(0,l.kt)("li",{parentName:"ul"},"path to a specific file, in this case, the path to a JSON file containing some bookmarks I have, check my ",(0,l.kt)("a",{parentName:"li",href:"/blog/bash/1-interactive-bookmarks"},"previous post"))),(0,l.kt)("p",null,"By defining them in the profile script as:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/1-declare-vars.sh#L3-",file:"./code/1-declare-vars.sh#L3-"},'# add this at the end of your profile\nlocalRepos="$HOME/repos"\nlocalDocuments="$HOME/Documents"\nbookmarksFile="$localRepos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n')),(0,l.kt)("p",null,"We can use them during the terminal session."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"using the variables after loading the terminal",src:a(173).Z})),(0,l.kt)("p",null,"Let's append the next function and aliases at the bash profile. Please note those are using the variables defined before."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/2-add-functions.sh#L3-",file:"./code/2-add-functions.sh#L3-"},'# add this at the end of your profile, after the variables declaration\n\nalias goToRepos="cd $localRepos"\nalias goToDocs="cd $localDocuments"\n\nlistBookmarks() {\n    local pathSelected=$(cat $bookmarksFile |\n        jq -r \'.[]\' |\n        fzf)\n\n    if [[ -n "$pathSelected" ]]; then\n        cd $pathSelected\n    else\n        echo "no bookmark selected"\n    fi\n}\n')),(0,l.kt)("p",null,"Now, we can use them after opening the Terminal."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"using the variables after loading the terminal",src:a(9762).Z})),(0,l.kt)("h2",{id:"behavior-vs-configuration"},"Behavior vs Configuration"),(0,l.kt)("p",null,"In ",(0,l.kt)("a",{parentName:"p",href:"/blog/bash/1-interactive-bookmarks"},"a previous post"),", the ",(0,l.kt)("inlineCode",{parentName:"p"},"listBookmarks")," function has the ",(0,l.kt)("inlineCode",{parentName:"p"},"bookmarksFile")," hardcoded. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=../1-interactive-bookmarks/code/listbookmarks.sh#L3-L4",file:"../1-interactive-bookmarks/code/listbookmarks.sh#L3-L4"},"listBookmarks() {\n    local bookmarksFile=./bookmarks.json\n")),(0,l.kt)("p",null,"As you see, its value refers to the ",(0,l.kt)("inlineCode",{parentName:"p"},"bookmarks.json")," location. What happens if we move that file to another folder? We would have to update the function. For one variable this doesn't seem to be a problem, right? But what if it is hardcoded in more functions? we would have to update them all, that is not extensible!"),(0,l.kt)("p",null,"Let's define two terms here:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Behavior: Functions implementation."),(0,l.kt)("li",{parentName:"ul"},"Configuration: Input parameters that the function relies on. In this case, ",(0,l.kt)("inlineCode",{parentName:"li"},"bookmarksFile"),". ")),(0,l.kt)("p",null,"By setting all the parameters outside the functions, we are creating a central place for the configuration."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/1-declare-vars.sh#L4-",file:"./code/1-declare-vars.sh#L4-"},'localRepos="$HOME/repos"\nlocalDocuments="$HOME/Documents"\nbookmarksFile="$localRepos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n')),(0,l.kt)("p",null,"And by calling those from the functions:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/2-add-functions.sh#L8-L9",file:"./code/2-add-functions.sh#L8-L9"},"listBookmarks() {\n    local pathSelected=$(cat $bookmarksFile |\n")),(0,l.kt)("p",null,"We are ",(0,l.kt)("strong",{parentName:"p"},"decoupling")," configuration from behavior.  If we want to migrate or share this setup, we won't need to look at the function implementations, we would only need to update the parameters."),(0,l.kt)(m.Z,{id:"d3mlE7uhX8KFgEmY",mdxType:"Gif"}),(0,l.kt)("h2",{id:"one-extra-mile-define-the-parameters-as-json"},"One extra mile: Define the parameters as JSON"),(0,l.kt)("p",null,"Let's migrate the variables to a JSON file as follows. Please note all the paths are now absolute."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:"file=./code/3-vars.json",file:"./code/3-vars.json"},'{\n    "localRepos": "/home/cangulo/repos",\n    "localDocuments": "/home/cangulo/Documents",\n    "bookmarksFile": "/home/cangulo/repos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n}\n')),(0,l.kt)("p",null,"To set the JSON keys as the parameters name we have to:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Define the json file path. We will consider those as the main settings."),(0,l.kt)("li",{parentName:"ol"},"Use the ",(0,l.kt)("inlineCode",{parentName:"li"},"jq")," command to retrieve the keys and values."),(0,l.kt)("li",{parentName:"ol"},"Use the ",(0,l.kt)("inlineCode",{parentName:"li"},"eval")," command to execute the ",(0,l.kt)("inlineCode",{parentName:"li"},"key=value"),"  for each one.")),(0,l.kt)("p",null,"Next is the solution, replace the variables declaration in your profile for this."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'settingsFile="/home/cangulo/repos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/3-vars.json"\neval "$(jq -r \'to_entries | .[] | .key + "=" + (.value | @sh)\' <$settingsFile)"\n')),(0,l.kt)("details",null,(0,l.kt)("summary",null,"In case you want to go into the solution details. Click here."),(0,l.kt)("p",null,"References:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Settings json keys as variables",(0,l.kt)("inlineCode",{parentName:"li"},"jq"),". ",(0,l.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/a/413886"},"Link")),(0,l.kt)("li",{parentName:"ul"},"What ",(0,l.kt)("inlineCode",{parentName:"li"},"@sh")," means in ",(0,l.kt)("inlineCode",{parentName:"li"},"jq"),". Quote string for bash. ",(0,l.kt)("a",{parentName:"li",href:"https://stedolan.github.io/jq/manual/"},"Link"))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries'"),"  structures the json as key/value pair array:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1-to_entries.png",src:a(95866).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[]'"),"  prepare the array items for the iteration:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"2-iterate-over-array-items.png",src:a(92714).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[] | .key + \"=\" + .value'")," build the ",(0,l.kt)("inlineCode",{parentName:"p"},"key=value")," expressions "),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"3-build-variable-declaration-code.png",src:a(82539).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[] | .key + \"=\" + (.value | @sh)'")," format the expression\n",(0,l.kt)("img",{alt:"4-format-declaration.png",src:a(8717).Z}))),(0,l.kt)("p",null,"Nothing more for Today! Do you think this is a good approach? How would you do it? Let me know in the comments below."),(0,l.kt)(c.ZP,{mdxType:"AboutMe"}),(0,l.kt)(u.ZP,{mdxType:"FullExperienceLink"}),(0,l.kt)(s.ZP,{mdxType:"Contact"}),(0,l.kt)(i.ShareDocusaurus,{preSlug:d.group,slug:d.slug,title:d.title,tags:d.tags,mdxType:"ShareDocusaurus"}),(0,l.kt)(r.Z,{mdxType:"Comments"}))}v.isMDXComponent=!0},58215:function(e,t,a){var n=a(67294);t.Z=function(e){var t=e.children,a=e.hidden,o=e.className;return n.createElement("div",{role:"tabpanel",hidden:a,className:o},t)}},26396:function(e,t,a){a.d(t,{Z:function(){return p}});var n=a(83117),o=a(67294),l=a(72389),r=a(79443);var i=function(){var e=(0,o.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=a(53810),u=a(86010),c="tabItem_1uMI";function m(e){var t,a,n,l=e.lazy,r=e.block,m=e.defaultValue,p=e.values,d=e.groupId,h=e.className,k=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=p?p:k.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),g=(0,s.lx)(f,(function(e,t){return e.value===t.value}));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===m?m:null!=(t=null!=m?m:null==(a=k.find((function(e){return e.props.default})))?void 0:a.props.value)?t:null==(n=k[0])?void 0:n.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=i(),N=v.tabGroupChoices,y=v.setTabGroupChoices,w=(0,o.useState)(b),x=w[0],C=w[1],E=[],T=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=d){var Z=N[d];null!=Z&&Z!==x&&f.some((function(e){return e.value===Z}))&&C(Z)}var L=function(e){var t=e.currentTarget,a=E.indexOf(t),n=f[a].value;n!==x&&(T(t),C(n),null!=d&&y(d,n))},I=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n=E.indexOf(e.currentTarget)+1;a=E[n]||E[0];break;case"ArrowLeft":var o=E.indexOf(e.currentTarget)-1;a=E[o]||E[E.length-1]}null==(t=a)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":r},h)},f.map((function(e){var t=e.value,a=e.label;return o.createElement("li",{role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,className:(0,u.Z)("tabs__item",c,{"tabs__item--active":x===t}),key:t,ref:function(e){return E.push(e)},onKeyDown:I,onFocus:L,onClick:L},null!=a?a:t)}))),l?(0,o.cloneElement)(k.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},k.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function p(e){var t=(0,l.Z)();return o.createElement(m,(0,n.Z)({key:String(t)},e))}},64888:function(e,t,a){var n=a(67294),o=a(84610),l=a(52263);t.Z=function(){var e=(0,l.default)().siteConfig,t=parseInt(e.customFields.hyvorTalkSiteId);return n.createElement("section",null,n.createElement("h2",null,"Comments"),n.createElement(o.Z.Embed,{loadMode:"scroll",websiteId:t}))}},46339:function(e,t,a){var n=a(67294),o=a(45697),l=a.n(o);function r(e){var t=e.id;return n.createElement("div",{style:{textAlign:"center"}},n.createElement("iframe",{src:"https://giphy.com/embed/"+t,width:"480",height:"270",frameBorder:"0",className:"giphy-embed",scrolling:"no"}),n.createElement("p",null,n.createElement("a",{href:"https://giphy.com/gifs/"+t},"via GIPHY")))}r.propTypes={id:l().string.isRequired},t.Z=r},95866:function(e,t,a){t.Z=a.p+"assets/images/1-to_entries-4082960636dd1aaf9e075d783ec05178.png"},92714:function(e,t,a){t.Z=a.p+"assets/images/2-iterate-over-array-items-5d3f7d575438227fa02b74587d21a3e9.png"},82539:function(e,t,a){t.Z=a.p+"assets/images/3-build-variable-declaration-code-ec3ce77139529c8fb6733e49085394ad.png"},8717:function(e,t,a){t.Z=a.p+"assets/images/4-format-declaration-c1fe5d41c43007a3643eb5df198f1d57.png"},9762:function(e,t,a){t.Z=a.p+"assets/images/use-gotoRepos-function-2ab80f76faa993a315443f6816e8b80a.gif"},173:function(e,t,a){t.Z=a.p+"assets/images/use-localrepo-variable-34d5977b3146db7772ad06c461d36716.gif"}}]);