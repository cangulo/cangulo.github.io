"use strict";(self.webpackChunkcangulo_github_io=self.webpackChunkcangulo_github_io||[]).push([[7659],{3704:function(t,e,a){a.r(e),a.d(e,{frontMatter:function(){return c},contentTitle:function(){return g},metadata:function(){return u},assets:function(){return h},toc:function(){return k},default:function(){return f}});var n=a(3117),r=a(102),i=(a(7294),a(3905)),l=a(4888),o=a(6785),s=a(9750),d=a(9741),p=a(8705),m=["components"],c={slug:"aws/2-aws-ct-aft-costs",title:"not finished - AWS Control Tower AFT Costs",date:new Date("2022-04-22T00:00:00.000Z"),group:"blog",authors:"cangulo",tags:["aws","projects","accounts","setup","costs"]},g=void 0,u={permalink:"/blog/aws/2-aws-ct-aft-costs",editUrl:"https://github.com/cangulo/cangulo.github.io/blob/main/blog/posts/aws/2-aft-costs/2-aws-control-tower-aft-costs.mdx",source:"@site/blog/posts/aws/2-aft-costs/2-aws-control-tower-aft-costs.mdx",title:"not finished - AWS Control Tower AFT Costs",description:"In this post I'm going to talk about the costs I faced using AWS Control Tower the latest 3 months. I recommend you read my previous post before continuing. Basic knowledge about AWS Control Tower is required.",date:"2022-04-22T00:00:00.000Z",formattedDate:"April 22, 2022",tags:[{label:"aws",permalink:"/blog/tags/aws"},{label:"projects",permalink:"/blog/tags/projects"},{label:"accounts",permalink:"/blog/tags/accounts"},{label:"setup",permalink:"/blog/tags/setup"},{label:"costs",permalink:"/blog/tags/costs"}],readingTime:7.23,truncated:!0,authors:[{name:"Carlos Angulo Mascarell",title:"Software Engineer",url:"https://github.com/cangulo",imageURL:"https://github.com/cangulo/cangulo/raw/main/profile_picture_preview_icon.png",key:"cangulo"}],nextItem:{title:"Reducing costs when using AWS Control Tower AFT",permalink:"/blog/aws/1-aws-ct-aft-reduce-cost"}},h={authorsImageUrls:[void 0]},k=[{value:"Context",id:"context",children:[{value:"Latest 3 months costs:",id:"latest-3-months-costs",children:[],level:3},{value:"Detailed cost: Services, API Operations and Usages Type",id:"detailed-cost-services-api-operations-and-usages-type",children:[],level:3},{value:"Analysis",id:"analysis",children:[],level:3},{value:"Questions",id:"questions",children:[],level:3}],level:2},{value:"What AWS Config does? Can I reduce it cost?",id:"what-aws-config-does-can-i-reduce-it-cost",children:[],level:2},{value:"What does the operation <code>EU-ElasticIP:IdleAddress</code> do? How can I decrease this cost?",id:"what-does-the-operation-eu-elasticipidleaddress-do-how-can-i-decrease-this-cost",children:[],level:2},{value:"KMS Costs",id:"kms-costs",children:[],level:2},{value:"Side Notes:",id:"side-notes",children:[{value:"Wait Carlos, were you using the Free Tier?",id:"wait-carlos-were-you-using-the-free-tier",children:[],level:3},{value:"Audit and Log AWS Accounts costs",id:"audit-and-log-aws-accounts-costs",children:[],level:3}],level:2},{value:"References:",id:"references",children:[{value:"Git Repositories",id:"git-repositories",children:[],level:3}],level:2}],N={toc:k};function f(t){var e=t.components,g=(0,r.Z)(t,m);return(0,i.kt)("wrapper",(0,n.Z)({},N,g,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"In this post I'm going to talk about the costs I faced using AWS Control Tower the latest 3 months. I recommend you read my ",(0,i.kt)("a",{parentName:"p",href:"/blog/aws/1-aws-ct-aft-reduce-cost"},"previous post")," before continuing. Basic knowledge about AWS Control Tower is required."))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This post is not finished yet"))),(0,i.kt)("h2",{id:"context"},"Context"),(0,i.kt)("p",null,"In my ",(0,i.kt)("a",{parentName:"p",href:"/blog/aws/1-aws-ct-aft-reduce-cost"},"last post")," I explained how I reduce costs when using AWS Control Tower services with the Account Factory for Terraform (AFT) approach, but only the costs I found using it for a few days. Now I'm going to talk about the costs for the latest 3 months."),(0,i.kt)("h3",{id:"latest-3-months-costs"},"Latest 3 months costs:"),(0,i.kt)("p",null,"Before I proceed, I have to mention my usage of AFT:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"I only used it during January and February. I created 5 AWS Accounts."),(0,i.kt)("li",{parentName:"ul"},"On March I didn't create or enroll any account. This was on purpose to check what are the fixed costs of having AFT inactive, I knew some Control Tower policies created have fixed costs no matter if you use them or not. I will dive into it in the next sections.")),(0,i.kt)("p",null,"And here we have the costs:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"latest 3 months costs",src:a(7880).Z})),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Service"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Config($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"VPC($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Tax($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"EC2-Other($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"CodeBuild($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"KMS($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Lambda($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"S3($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"DynamoDB($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Backup($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"EC2-Instances($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"CloudWatch($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Total cost ($)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"January"),(0,i.kt)("td",{parentName:"tr",align:"right"},"16.58"),(0,i.kt)("td",{parentName:"tr",align:"right"},"17.34"),(0,i.kt)("td",{parentName:"tr",align:"right"},"10.62"),(0,i.kt)("td",{parentName:"tr",align:"right"},"8.41"),(0,i.kt)("td",{parentName:"tr",align:"right"},"6.62"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.56"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.09"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"61.2")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"February"),(0,i.kt)("td",{parentName:"tr",align:"right"},"13.9"),(0,i.kt)("td",{parentName:"tr",align:"right"},"12.5"),(0,i.kt)("td",{parentName:"tr",align:"right"},"10.98"),(0,i.kt)("td",{parentName:"tr",align:"right"},"9.04"),(0,i.kt)("td",{parentName:"tr",align:"right"},"8.5"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.87"),(0,i.kt)("td",{parentName:"tr",align:"right"},"6.44"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"63.22")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"March"),(0,i.kt)("td",{parentName:"tr",align:"right"},"9.03"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"4.72"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.44"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"6"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.01"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"27.19"))))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Let's ignore the ",(0,i.kt)("inlineCode",{parentName:"p"},"Tax")," from the plot and table."))),(0,i.kt)("h3",{id:"detailed-cost-services-api-operations-and-usages-type"},"Detailed cost: Services, API Operations and Usages Type"),(0,i.kt)("p",null,"Let me write down the services used:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"AWS Config:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"None")," "),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-ConfigurationItemRecorded")))),(0,i.kt)("li",{parentName:"ul"},"VPC: ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"VpcEndpoint")," "),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-VpcEndpoint-Hours")))),(0,i.kt)("li",{parentName:"ul"},"EC2-Other:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operations: ",(0,i.kt)("inlineCode",{parentName:"li"},"NatGateway"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"AssociateAddressVPC"),", here are the costs:"),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-NatGateway-Hours"),",",(0,i.kt)("inlineCode",{parentName:"li"},"EU-ElasticIP:IdleAddress"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-NatGateway-Bytes"))))),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"API Operation"),(0,i.kt)("th",{parentName:"tr",align:"right"},"NatGateway($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"AssociateAddressVPC($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Total"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"January"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.28"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.13"),(0,i.kt)("td",{parentName:"tr",align:"right"},"8.41")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"February"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.02"),(0,i.kt)("td",{parentName:"tr",align:"right"},"2.02"),(0,i.kt)("td",{parentName:"tr",align:"right"},"9.04")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"March"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.44"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.44"))))),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Usage Type"),(0,i.kt)("th",{parentName:"tr",align:"right"},"EU-NatGateway-Hours($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"EU-ElasticIP:IdleAddress($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"EU-NatGateway-Bytes($)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"January"),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.2"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.123"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.08")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"February"),(0,i.kt)("td",{parentName:"tr",align:"right"},"6.24"),(0,i.kt)("td",{parentName:"tr",align:"right"},"2.019"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.78")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"March"),(0,i.kt)("td",{parentName:"tr",align:"right"}),(0,i.kt)("td",{parentName:"tr",align:"right"},"7.435"),(0,i.kt)("td",{parentName:"tr",align:"right"}))))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"CodeBuild: ",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"Build")),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-Build-Min:Linux:g1.medium")," (January), ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-Build-Min:Linux:g1.small")," (February). Each usage type is defined ",(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/es/codebuild/pricing/"},"here")," and it might from one month to another because a ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/aws-ia/terraform-aws-control_tower_account_factory/releases"},"release on the original github")," that I forked."))),(0,i.kt)("li",{parentName:"ul"},"Key Management Service:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"Unknown")),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"eu-west-1-KMS-Keys"),",",(0,i.kt)("inlineCode",{parentName:"li"},"eu-west-2-KMS-Keys"))))),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Usage Type"),(0,i.kt)("th",{parentName:"tr",align:"right"},"eu-west-1-KMS-Keys($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"eu-west-2-KMS-Keys($)"),(0,i.kt)("th",{parentName:"tr",align:"right"},"Total"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"January"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.06"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.5"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.56")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"February"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.24"),(0,i.kt)("td",{parentName:"tr",align:"right"},"0.63"),(0,i.kt)("td",{parentName:"tr",align:"right"},"1.87")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"March"),(0,i.kt)("td",{parentName:"tr",align:"right"},"4"),(0,i.kt)("td",{parentName:"tr",align:"right"},"2"),(0,i.kt)("td",{parentName:"tr",align:"right"},"6"))))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Lambda:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"API Operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"Invoke")),(0,i.kt)("li",{parentName:"ul"},"Usage Type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-Lambda-GB-Second"))))),(0,i.kt)("h3",{id:"analysis"},"Analysis"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The only services that still cost without usage are:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"AWS Config"),(0,i.kt)("li",{parentName:"ul"},"EC2-Other"),(0,i.kt)("li",{parentName:"ul"},"KMS"))),(0,i.kt)("li",{parentName:"ul"},"AWS Config is the highest cost. I will talk about this in the next section: ",(0,i.kt)("a",{parentName:"li",href:"#what-aws-config-does-can-i-reduce-it-cost"},"aws config section")),(0,i.kt)("li",{parentName:"ul"},"There are no cost for  the services ",(0,i.kt)("inlineCode",{parentName:"li"},"CodeBuild")," and  ",(0,i.kt)("inlineCode",{parentName:"li"},"Lambda"),". This is because I haven't created nor enrolled any account in March."),(0,i.kt)("li",{parentName:"ul"},"Using the improvement to disable the VPC endpoints and NAT explained in my ",(0,i.kt)("a",{parentName:"li",href:"/blog/aws/1-aws-ct-aft-reduce-cost"},"previous post"),", in March the cost is 0 for the following operations:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EU-VpcEndpoint-Hours")," - service ",(0,i.kt)("inlineCode",{parentName:"li"},"VPC")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EU-NatGateway-Hours")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-NatGateway-Bytes")," - service ",(0,i.kt)("inlineCode",{parentName:"li"},"EC2-Other")))),(0,i.kt)("li",{parentName:"ul"},"However, ",(0,i.kt)("strong",{parentName:"li"},"there is still a cost in the ",(0,i.kt)("inlineCode",{parentName:"strong"},"EC2-Other"))," service, it is for the API Operation ",(0,i.kt)("inlineCode",{parentName:"li"},"AssociateAddressVPC")," , usage type: ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-ElasticIP:IdleAddress"),". "),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("strong",{parentName:"li"},"KMS cost has increase in March"),". I didn't expect this one because I didn't use AFT during that month."),(0,i.kt)("li",{parentName:"ul"},"Other services ( ",(0,i.kt)("inlineCode",{parentName:"li"},"S3")," ,",(0,i.kt)("inlineCode",{parentName:"li"},"DynamoDB")," ,",(0,i.kt)("inlineCode",{parentName:"li"},"Backup")," ,",(0,i.kt)("inlineCode",{parentName:"li"},"EC2-Instances")," ,",(0,i.kt)("inlineCode",{parentName:"li"},"CloudWatch")," ) have no cost or less than 0.10.")),(0,i.kt)("h3",{id:"questions"},"Questions"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"What AWS Config does ? Can I reduce it cost ? "),(0,i.kt)("li",{parentName:"ul"},"What does the operation ",(0,i.kt)("inlineCode",{parentName:"li"},"EU-ElasticIP:IdleAddress")," do? How can I decrease this cost? "),(0,i.kt)("li",{parentName:"ul"},"Why KMS cost increase in March if I didn't use AFT? How can I decrease it?")),(0,i.kt)("h2",{id:"what-aws-config-does-can-i-reduce-it-cost"},"What AWS Config does? Can I reduce it cost?"),(0,i.kt)("p",null,"AWS Config is a AWS service that allow us to record and evaluate resources configurations. You can check the full description ",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/config/?nc1=h_ls"},"here"),".\nThis service is been used by the AWS Control Tower as described next:"),(0,i.kt)("p",null,"AWS Control Tower has a feature named ",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/controltower/latest/userguide/guardrails.html"},"Guardrails"),", those are rules validated against resources created in enrolled accounts. This provides governance to AWS environments.\nThose Guardrails can be preventive (ensuring your account maintain compliance) or Detective (detect noncompliance resources) based on the behavior.\nThe detective guardrails are implemented using AWS Config rules.\nThis means Control Tower call AWS Config to validate the configuration of the resources when a detective guardrails is active."),(0,i.kt)("p",null,"okey, too much theory, the most importance, next are the two detective guardrails activated by default in a landing zone:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Guardrails detectives",src:a(1462).Z})),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The next approach works for me because I'm using AFT sporadically and for personal projects. I don't recommend it for companies."))),(0,i.kt)("p",null,"Action done: "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to AWS Organizations. Create a OU, I name it ",(0,i.kt)("inlineCode",{parentName:"li"},"outside-act"),"."),(0,i.kt)("li",{parentName:"ol"},"Move the AFT account to the new OU."),(0,i.kt)("li",{parentName:"ol"},"Check it is not enrolled.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aws-ct-account-outside-ou",src:a(998).Z})),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Open the AWS Console, login using the AFT Account, go to AWS Config, open Settings, click on ",(0,i.kt)("inlineCode",{parentName:"li"},"Edit"),". and select stop recording, save it.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"aws-config-settings",src:a(3192).Z}),"\n",(0,i.kt)("img",{alt:"aws-config-settings-edit",src:a(9914).Z}),"\n",(0,i.kt)("img",{alt:"aws-config-setting-recorder-off",src:a(8170).Z})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"costs-after-disable-aws-config-recorder",src:a(5636).Z})),(0,i.kt)("p",null,"After disabling Recorder on April 19 the cost was reduced from ",(0,i.kt)("inlineCode",{parentName:"p"},"0.30 $")," per day to ",(0,i.kt)("inlineCode",{parentName:"p"},"0.03 $")),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Service"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-16"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-17"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-18"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-19"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-20"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-21"),(0,i.kt)("th",{parentName:"tr",align:null},"2022-04-22"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Config($)"),(0,i.kt)("td",{parentName:"tr",align:null},"0.296"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"0.296")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"0.236")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("strong",{parentName:"td"},"0.008")),(0,i.kt)("td",{parentName:"tr",align:null},"0.008"),(0,i.kt)("td",{parentName:"tr",align:null},"0.008"),(0,i.kt)("td",{parentName:"tr",align:null},"0.008"))))),(0,i.kt)("h2",{id:"what-does-the-operation-eu-elasticipidleaddress-do-how-can-i-decrease-this-cost"},"What does the operation ",(0,i.kt)("inlineCode",{parentName:"h2"},"EU-ElasticIP:IdleAddress")," do? How can I decrease this cost?"),(0,i.kt)("p",null,"I discovered there were two Elastic IP addresses not linked to any EC2 instances, this is why it is been charged in Idle state. I release them manually, through the AWS Console, so no more cost is generated. More details about why it was been charge ",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/premiumsupport/knowledge-center/elastic-ip-charges/"},"here"),"."),(0,i.kt)("p",null,"As we want to avoid manual intervention, I made the elastic IP creation depend on the ",(0,i.kt)("inlineCode",{parentName:"p"},"aft_vpc_nat_gateway")," parameter I introduce for reducing NAT costs in my ",(0,i.kt)("a",{parentName:"p",href:"/blog/aws/1-aws-ct-aft-reduce-cost"},"previous post.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"elastic-ip-modification",src:a(5507).Z})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/cangulo-aws-aft/terraform-aws-control_tower_account_factory/commit/e11466b8e6beaf4364f0343b5d44f0939050dbf3"},"Commit")),(0,i.kt)("h2",{id:"kms-costs"},"KMS Costs"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"I will answer this one in my next post. Too much for this one."))),(0,i.kt)("h2",{id:"side-notes"},"Side Notes:"),(0,i.kt)("h3",{id:"wait-carlos-were-you-using-the-free-tier"},"Wait Carlos, were you using the Free Tier?"),(0,i.kt)("p",null,"Yes, I was, and that might reduce the final costs I had, but I don't expect them to be significantly different nor to change any conclusion of this article. "),(0,i.kt)("p",null,"Next is my remaining Free Tier quota on April 18, as you see some services already exceeded the free layer though I haven't used the AFT resources since later February. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"free tier stats",src:a(9100).Z})),(0,i.kt)("h3",{id:"audit-and-log-aws-accounts-costs"},"Audit and Log AWS Accounts costs"),(0,i.kt)("p",null,"For using AWS Control Tower there are 3 accounts required:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Audit Account."),(0,i.kt)("li",{parentName:"ul"},"Log Archive Account."),(0,i.kt)("li",{parentName:"ul"},"AFT Account where all the resources to process account creation request are.")),(0,i.kt)("p",null,"Next are the costs per account"),(0,i.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Linked Account Name"),(0,i.kt)("th",{parentName:"tr",align:null},"cangulo_aft ($)"),(0,i.kt)("th",{parentName:"tr",align:null},"Log Archive ($)"),(0,i.kt)("th",{parentName:"tr",align:null},"Audit ($)"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"January"),(0,i.kt)("td",{parentName:"tr",align:null},"61.2"),(0,i.kt)("td",{parentName:"tr",align:null},"1.8"),(0,i.kt)("td",{parentName:"tr",align:null},"0.2")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"February"),(0,i.kt)("td",{parentName:"tr",align:null},"63.3"),(0,i.kt)("td",{parentName:"tr",align:null},"1.5"),(0,i.kt)("td",{parentName:"tr",align:null},"0.02")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"March"),(0,i.kt)("td",{parentName:"tr",align:null},"27.2"),(0,i.kt)("td",{parentName:"tr",align:null},"2.8"),(0,i.kt)("td",{parentName:"tr",align:null},"0.01"))))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"In this post I'm only referring to the AFT account costs. "))),(0,i.kt)("h2",{id:"references"},"References:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/controltower/latest/userguide/getting-started-with-control-tower.html"},"Starting with Control Tower"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"If you are running ephemeral workloads from accounts in AWS Control Tower, you may see an increase in costs associated with AWS Config. Contact your AWS account representative for more specific information about managing these costs.")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/controltower/latest/userguide/guardrails.html"},"control tower user guide"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"The detective guardrails are implemented using AWS Config rules"))))),(0,i.kt)("h3",{id:"git-repositories"},"Git Repositories"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/learn-terraform-aft-account-provisioning-customizations"},"learn-terraform-aft-account-provisioning-customizations"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/learn-terraform-aft-account-customizations"},"learn-terraform-aft-account-customizations"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/learn-terraform-aft-global-customizations"},"learn-terraform-aft-global-customizations"),(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/learn-terraform-aft-account-request"},"learn-terraform-aft-account-request")),(0,i.kt)(p.ZP,{mdxType:"AboutMe"}),(0,i.kt)(d.ZP,{mdxType:"FullExperienceLink"}),(0,i.kt)(s.ZP,{mdxType:"Contact"}),(0,i.kt)(o.ShareDocusaurus,{preSlug:c.group,slug:c.slug,title:c.title,tags:c.tags,mdxType:"ShareDocusaurus"}),(0,i.kt)(l.Z,{mdxType:"Comments"}))}f.isMDXComponent=!0},4888:function(t,e,a){var n=a(7294),r=a(4610),i=a(2263);e.Z=function(){var t=(0,i.default)().siteConfig,e=parseInt(t.customFields.hyvorTalkSiteId);return n.createElement("section",null,n.createElement("h2",null,"Comments"),n.createElement(r.Z.Embed,{loadMode:"scroll",websiteId:e}))}},8170:function(t,e,a){e.Z=a.p+"assets/images/aws-config-setting-recorder-off-b51c0f28cc3df477567431a3e876eb2e.png"},9914:function(t,e,a){e.Z=a.p+"assets/images/aws-config-settings-edit-f6fe670c0c5f6efbbab9beae5d5d78e7.png"},3192:function(t,e,a){e.Z=a.p+"assets/images/aws-config-settings-6e624a69e9718c60f5ff5896e86f9909.png"},998:function(t,e,a){e.Z=a.p+"assets/images/aws-ct-account-outside-ou-51cdc1d3df4c2c743f7e4e10368ff2b1.png"},5636:function(t,e,a){e.Z=a.p+"assets/images/costs-after-disable-aws-config-recorder-60faad4259ebc1624c0372022be4e559.png"},7880:function(t,e,a){e.Z=a.p+"assets/images/costs-latest-3-months-9eaba09962e4eb993636e391267cb176.png"},5507:function(t,e,a){e.Z=a.p+"assets/images/elastic-ip-modification-in-tf-2449beed77d3a358674fd492f865f7f4.png"},9100:function(t,e,a){e.Z=a.p+"assets/images/free-tier-stats-ff8212a040cdbd398e160c3a88f5594b.png"},1462:function(t,e,a){e.Z=a.p+"assets/images/guardrails-default-detectives-38e94cd92e5898b3f71353e7b38f3a37.png"}}]);