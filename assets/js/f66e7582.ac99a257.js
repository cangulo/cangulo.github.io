"use strict";(self.webpackChunkcangulo_github_io=self.webpackChunkcangulo_github_io||[]).push([[2232],{3024:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return p},contentTitle:function(){return m},metadata:function(){return d},assets:function(){return h},toc:function(){return f},default:function(){return k}});var n=a(3117),o=a(102),l=(a(7294),a(3905)),r=a(6785),i=a(6339),s=a(3114),u=(a(6396),a(8215),a(615)),c=["components"],p={slug:"bash/3-load-vars",title:"Load custom variables at Terminal startup",date:new Date("2020-12-15T00:00:00.000Z"),authors:"cangulo",tags:["linux","productivity","hack","bash","zsh","terminal"]},m=void 0,d={permalink:"/blog/bash/3-load-vars",editUrl:"https://github.com/cangulo/cangulo.github.io/blob/main/blog/posts/bash/3-load-vars/3-load-vars.mdx",source:"@site/blog/posts/bash/3-load-vars/3-load-vars.mdx",title:"Load custom variables at Terminal startup",description:"In this post, I will explain how to import custom environment variables from a JSON file.",date:"2020-12-15T00:00:00.000Z",formattedDate:"December 15, 2020",tags:[{label:"linux",permalink:"/blog/tags/linux"},{label:"productivity",permalink:"/blog/tags/productivity"},{label:"hack",permalink:"/blog/tags/hack"},{label:"bash",permalink:"/blog/tags/bash"},{label:"zsh",permalink:"/blog/tags/zsh"},{label:"terminal",permalink:"/blog/tags/terminal"}],readingTime:3.13,truncated:!0,authors:[{name:"Carlos Angulo Mascarell",title:"Software Engineer",url:"https://github.com/cangulo",imageURL:"https://github.com/cangulo/cangulo/raw/main/profile_picture_preview_icon.png",key:"cangulo"}],prevItem:{title:"How to use a repository for importing your bash scripts and shortcuts",permalink:"/blog/bash/4-create-config-repo"},nextItem:{title:"Add shortcuts to your bash terminal",permalink:"/blog/bash/2-add-shortcuts"}},h={authorsImageUrls:[void 0]},f=[{value:"Requirements",id:"requirements",children:[],level:2},{value:"Notes",id:"notes",children:[],level:2},{value:"Variables",id:"variables",children:[],level:2},{value:"Behavior vs Configuration",id:"behavior-vs-configuration",children:[],level:2},{value:"One extra mile: Define the parameters as JSON",id:"one-extra-mile-define-the-parameters-as-json",children:[],level:2}],b={toc:f};function k(e){var t=e.components,m=(0,o.Z)(e,c);return(0,l.kt)("wrapper",(0,n.Z)({},b,m,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"In this post, I will explain how to import custom environment variables from a JSON file.\nI will also improve the shortcuts we create in the previous posts."),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Linux (I'm using ",(0,l.kt)("a",{parentName:"li",href:"https://elementary.io"},"Elementary OS"),", a Ubuntu-based distro, check it!)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://code.visualstudio.com"},"VS Code"),". If you don't want to use it, change all the ",(0,l.kt)("inlineCode",{parentName:"li"},"code")," commands in the bash code for your text editor. Alternatives: ",(0,l.kt)("em",{parentName:"li"},"gedit")," or ",(0,l.kt)("a",{parentName:"li",href:"https://gitlab.gnome.org/GNOME/gnome-text-editor"},"gnome-text-editor"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/junegunn/fzf"},"fzf")," command-line fuzzy finder")),(0,l.kt)("h2",{id:"notes"},"Notes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Remember to add execution permissions to the scripts through ",(0,l.kt)("inlineCode",{parentName:"li"},"chmod +x")),(0,l.kt)("li",{parentName:"ul"},"Profile script: ",(0,l.kt)("inlineCode",{parentName:"li"},"$HOME/.bashrc")," for bash terminal and ",(0,l.kt)("inlineCode",{parentName:"li"},"$HOME/.zshrc")," for zsh ")),(0,l.kt)("h2",{id:"variables"},"Variables"),(0,l.kt)("p",null,"Let's say I want to define some variables as:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"my local github repositories path"),(0,l.kt)("li",{parentName:"ul"},"my documents path"),(0,l.kt)("li",{parentName:"ul"},"path to a specific file, in this case, the path to a JSON file containing some bookmarks I have, check my ",(0,l.kt)("a",{parentName:"li",href:"/blog/bash/1-interactive-bookmarks"},"previous post"))),(0,l.kt)("p",null,"By defining them in the profile script as:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/1-declare-vars.sh#L3-",file:"./code/1-declare-vars.sh#L3-"},'# add this at the end of your profile\nlocalRepos="$HOME/repos"\nlocalDocuments="$HOME/Documents"\nbookmarksFile="$localRepos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n')),(0,l.kt)("p",null,"We can use them during the terminal session."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"using the variables after loading the terminal",src:a(173).Z})),(0,l.kt)("p",null,"Let's append the next function and aliases at the bash profile. Please note those are using the variables defined before."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/2-add-functions.sh#L3-",file:"./code/2-add-functions.sh#L3-"},'# add this at the end of your profile, after the variables declaration\n\nalias goToRepos="cd $localRepos"\nalias goToDocs="cd $localDocuments"\n\nlistBookmarks() {\n    local pathSelected=$(cat $bookmarksFile |\n        jq -r \'.[]\' |\n        fzf)\n\n    if [[ -n "$pathSelected" ]]; then\n        cd $pathSelected\n    else\n        echo "no bookmark selected"\n    fi\n}\n')),(0,l.kt)("p",null,"Now, we can use them after opening the Terminal."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"using the variables after loading the terminal",src:a(9762).Z})),(0,l.kt)("h2",{id:"behavior-vs-configuration"},"Behavior vs Configuration"),(0,l.kt)("p",null,"In ",(0,l.kt)("a",{parentName:"p",href:"/blog/bash/1-interactive-bookmarks"},"a previous post"),", the ",(0,l.kt)("inlineCode",{parentName:"p"},"listBookmarks")," function has the ",(0,l.kt)("inlineCode",{parentName:"p"},"bookmarksFile")," hardcoded. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=../1-interactive-bookmarks/code/listbookmarks.sh#L3-L4",file:"../1-interactive-bookmarks/code/listbookmarks.sh#L3-L4"},"listBookmarks() {\n    local bookmarksFile=./bookmarks.json\n")),(0,l.kt)("p",null,"As you see, its value refers to the ",(0,l.kt)("inlineCode",{parentName:"p"},"bookmarks.json")," location. What happens if we move that file to another folder? We would have to update the function. For one variable this doesn't seem to be a problem, right? But what if it is hardcoded in more functions? we would have to update them all, that is not extensible!"),(0,l.kt)("p",null,"Let's define two terms here:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Behavior: Functions implementation."),(0,l.kt)("li",{parentName:"ul"},"Configuration: Input parameters that the function relies on. In this case, ",(0,l.kt)("inlineCode",{parentName:"li"},"bookmarksFile"),". ")),(0,l.kt)("p",null,"By setting all the parameters outside the functions, we are creating a central place for the configuration."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/1-declare-vars.sh#L4-",file:"./code/1-declare-vars.sh#L4-"},'localRepos="$HOME/repos"\nlocalDocuments="$HOME/Documents"\nbookmarksFile="$localRepos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n')),(0,l.kt)("p",null,"And by calling those from the functions:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:"file=./code/2-add-functions.sh#L8-L9",file:"./code/2-add-functions.sh#L8-L9"},"listBookmarks() {\n    local pathSelected=$(cat $bookmarksFile |\n")),(0,l.kt)("p",null,"We are ",(0,l.kt)("strong",{parentName:"p"},"decoupling")," configuration from behavior.  If we want to migrate or share this setup, we won't need to look at the function implementations, we would only need to update the parameters."),(0,l.kt)(i.Z,{id:"d3mlE7uhX8KFgEmY",mdxType:"Gif"}),(0,l.kt)("h2",{id:"one-extra-mile-define-the-parameters-as-json"},"One extra mile: Define the parameters as JSON"),(0,l.kt)("p",null,"Let's migrate the variables to a JSON file as follows. Please note all the paths are now absolute."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:"file=./code/3-vars.json",file:"./code/3-vars.json"},'{\n    "localRepos": "/home/cangulo/repos",\n    "localDocuments": "/home/cangulo/Documents",\n    "bookmarksFile": "/home/cangulo/repos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/4-bookmarks.json"\n}\n')),(0,l.kt)("p",null,"To set the JSON keys as the parameters name we have to:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Define the json file path. We will consider those as the main settings."),(0,l.kt)("li",{parentName:"ol"},"Use the ",(0,l.kt)("inlineCode",{parentName:"li"},"jq")," command to retrieve the keys and values."),(0,l.kt)("li",{parentName:"ol"},"Use the ",(0,l.kt)("inlineCode",{parentName:"li"},"eval")," command to execute the ",(0,l.kt)("inlineCode",{parentName:"li"},"key=value"),"  for each one.")),(0,l.kt)("p",null,"Next is the solution, replace the variables declaration in your profile for this."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'settingsFile="/home/cangulo/repos/cangulo-blog/cangulo.github.io/blog/posts/bash/3-setup-custom-env-variables/code/3-vars.json"\neval "$(jq -r \'to_entries | .[] | .key + "=" + (.value | @sh)\' <$settingsFile)"\n')),(0,l.kt)("details",null,(0,l.kt)("summary",null,"In case you want to go into the solution details. Click here."),(0,l.kt)("p",null,"References:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Settings json keys as variables",(0,l.kt)("inlineCode",{parentName:"li"},"jq"),". ",(0,l.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/a/413886"},"Link")),(0,l.kt)("li",{parentName:"ul"},"What ",(0,l.kt)("inlineCode",{parentName:"li"},"@sh")," means in ",(0,l.kt)("inlineCode",{parentName:"li"},"jq"),". Quote string for bash. ",(0,l.kt)("a",{parentName:"li",href:"https://stedolan.github.io/jq/manual/"},"Link"))),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries'"),"  structures the json as key/value pair array:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1-to_entries.png",src:a(5866).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[]'"),"  prepare the array items for the iteration:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"2-iterate-over-array-items.png",src:a(2714).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[] | .key + \"=\" + .value'")," build the ",(0,l.kt)("inlineCode",{parentName:"p"},"key=value")," expressions "),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"3-build-variable-declaration-code.png",src:a(2539).Z})),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"jq -r 'to_entries | .[] | .key + \"=\" + (.value | @sh)'")," format the expression\n",(0,l.kt)("img",{alt:"4-format-declaration.png",src:a(8717).Z}))),(0,l.kt)("p",null,"Nothing more for Today! Do you think this is a good approach? How would you do it? Let me know in the comments below."),(0,l.kt)(s.ZP,{mdxType:"AboutMe"}),(0,l.kt)(r.ShareDocusaurus,{preSlug:"blog/posts",slug:p.slug,title:p.title,tags:p.tags,mdxType:"ShareDocusaurus"}),(0,l.kt)(u.Z,{mdxType:"Comments"}))}k.isMDXComponent=!0},8215:function(e,t,a){var n=a(7294);t.Z=function(e){var t=e.children,a=e.hidden,o=e.className;return n.createElement("div",{role:"tabpanel",hidden:a,className:o},t)}},6396:function(e,t,a){a.d(t,{Z:function(){return m}});var n=a(3117),o=a(7294),l=a(2389),r=a(9443);var i=function(){var e=(0,o.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=a(3810),u=a(6010),c="tabItem_1uMI";function p(e){var t,a,n,l=e.lazy,r=e.block,p=e.defaultValue,m=e.values,d=e.groupId,h=e.className,f=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=m?m:f.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),k=(0,s.lx)(b,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var g=null===p?p:null!=(t=null!=p?p:null==(a=f.find((function(e){return e.props.default})))?void 0:a.props.value)?t:null==(n=f[0])?void 0:n.props.value;if(null!==g&&!b.some((function(e){return e.value===g})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+g+'" but none of its children has the corresponding value. Available values are: '+b.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=i(),y=v.tabGroupChoices,N=v.setTabGroupChoices,w=(0,o.useState)(g),E=w[0],C=w[1],x=[],I=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=d){var T=y[d];null!=T&&T!==E&&b.some((function(e){return e.value===T}))&&C(T)}var _=function(e){var t=e.currentTarget,a=x.indexOf(t),n=b[a].value;n!==E&&(I(t),C(n),null!=d&&N(d,n))},j=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n=x.indexOf(e.currentTarget)+1;a=x[n]||x[0];break;case"ArrowLeft":var o=x.indexOf(e.currentTarget)-1;a=x[o]||x[x.length-1]}null==(t=a)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":r},h)},b.map((function(e){var t=e.value,a=e.label;return o.createElement("li",{role:"tab",tabIndex:E===t?0:-1,"aria-selected":E===t,className:(0,u.Z)("tabs__item",c,{"tabs__item--active":E===t}),key:t,ref:function(e){return x.push(e)},onKeyDown:j,onFocus:_,onClick:_},null!=a?a:t)}))),l?(0,o.cloneElement)(f.filter((function(e){return e.props.value===E}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==E})}))))}function m(e){var t=(0,l.Z)();return o.createElement(p,(0,n.Z)({key:String(t)},e))}},615:function(e,t,a){a.d(t,{Z:function(){return b}});var n=a(7294),o=a(5697),l=a.n(o);function r(e,t){var a=document.createElement("script");a.src=e,a.id=t,document.body.appendChild(a)}function i(e){var t=document.getElementById(e);e&&t.parentElement.removeChild(t)}var s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},m=function(e){function t(){return s(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"setVariables",value:function(){window.HYVOR_TALK_WEBSITE=this.props.websiteId,window.HYVOR_TALK_CONFIG={url:this.props.url||!1,id:this.props.id||!1,title:this.props.title||document.title,loadMode:this.props.loadMode||"default",language:this.props.language||null,sso:this.props.sso||null,palette:this.props.palette||null}}},{key:"addScript",value:function(){document.getElementById("ht-embed-script")&&i("ht-embed-script"),r("//talk.hyvor.com/web-api/embed","ht-embed-script")}},{key:"componentDidMount",value:function(){this.setVariables(),this.addScript()}},{key:"render",value:function(){return n.createElement("div",{id:"hyvor-talk-view"})}}]),t}(n.Component);m.propTypes={websiteId:l().number.isRequired,url:l().any,id:l().any,title:l().string,loadMode:l().any,language:l().string,sso:l().object,palette:l().object};var d=function(e){function t(){return s(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"setVariables",value:function(){this.props.websiteId&&(window.HYVOR_TALK_WEBSITE=this.props.websiteId)}},{key:"componentDidMount",value:function(){this.setVariables();var e="ht-comment-count-script";document.getElementById(e)&&i(e),r("//talk.hyvor.com/web-api/count/",e)}},{key:"render",value:function(){return n.createElement("span",{"data-talk-id":this.props.id,"data-talk-mode":this.props.mode||"default"})}}]),t}(n.Component);d.propTypes={id:l().any,mode:l().any,websiteId:l().number};var h={Embed:m,CommentCount:d},f=a(2263),b=function(){var e=(0,f.default)().siteConfig,t=parseInt(e.customFields.hyvorTalkSiteId);return n.createElement("section",null,n.createElement("h2",null,"Comments"),n.createElement(h.Embed,{loadMode:"scroll",websiteId:t}))}},6339:function(e,t,a){var n=a(7294),o=a(5697),l=a.n(o);function r(e){var t=e.id;return n.createElement("div",{style:{textAlign:"center"}},n.createElement("iframe",{src:"https://giphy.com/embed/"+t,width:"480",height:"270",frameBorder:"0",className:"giphy-embed",scrolling:"no"}),n.createElement("p",null,n.createElement("a",{href:"https://giphy.com/gifs/"+t},"via GIPHY")))}r.propTypes={id:l().string.isRequired},t.Z=r},5866:function(e,t,a){t.Z=a.p+"assets/images/1-to_entries-4082960636dd1aaf9e075d783ec05178.png"},2714:function(e,t,a){t.Z=a.p+"assets/images/2-iterate-over-array-items-5d3f7d575438227fa02b74587d21a3e9.png"},2539:function(e,t,a){t.Z=a.p+"assets/images/3-build-variable-declaration-code-ec3ce77139529c8fb6733e49085394ad.png"},8717:function(e,t,a){t.Z=a.p+"assets/images/4-format-declaration-c1fe5d41c43007a3643eb5df198f1d57.png"},9762:function(e,t,a){t.Z=a.p+"assets/images/use-gotoRepos-function-2ab80f76faa993a315443f6816e8b80a.gif"},173:function(e,t,a){t.Z=a.p+"assets/images/use-localrepo-variable-34d5977b3146db7772ad06c461d36716.gif"}}]);